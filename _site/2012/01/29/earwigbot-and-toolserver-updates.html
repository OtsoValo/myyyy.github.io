<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>EarwigBot and Toolserver Updates &ndash; good-bye</title>
        <meta name="description" content="More progress on EarwigBot and the Toolserver site rewrite, including dynamic backgrounds &#124; Ben Kurtovic's blog">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/png" href="/static/favicon.png" />
        <link rel="stylesheet" href="/static/main.css" />
        <link rel="stylesheet" href="/static/syntax.css" />
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Ben Kurtovic" />
        <script src="//code.jquery.com/jquery-1.12.3.min.js" integrity="sha256-aaODHAgvwQW1bFOGXMeX+pC4PZIPsvn2h1sArYOhgXQ=" crossorigin="anonymous"></script>
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="/static/main.js"></script>
    </head>
    <body>
        <div id="banner">
            <a href="/">
                <img src="/static/avatar.png" title="good bye" alt="SYFY" />
                <h1>再 见。</h1>
            </a>
        </div>
        <div id="container">
            <h1>EarwigBot and Toolserver Updates</h1>
<div id="content">
    <ul id="post-info">
        <li><span><i class="fa fa-tag"></i> Tags:</span>
            
                <a href="/#Wikipedia" class="post-tag">Wikipedia</a>
            
                <a href="/#Status report" class="post-tag">Status report</a>
            
        <li><span><i class="fa fa-clock-o"></i> Date:</span> January 29, 2012</li>
        <li><span><i class="fa fa-comments"></i></span> <a href="#disqus_thread">Jump to comments</a></li>
    </ul>
    <div id="post">
        <p>Haven’t really said much in a while, so I felt it appropriate to make a new
blog post. No, I’m not dead, and yes, I <em>am</em> busy working on my Wikipedia
responsibilities, including EarwigBot and my Toolserver site (which I’ll go
into detail about in a bit). Progress is not as quick now as it was over the
summer, and you can blame school for the delay in getting things done. My
primary to-do list for Wikipedia right now looks like this:</p>

<ol>
  <li>Finish copyvio detection in the new EarwigBot</li>
  <li>Integrate EarwigBot’s copyvio detection with the new Toolserver site</li>
</ol>

<p>#1 has a good portion of its work done, but I still have to finish the actual
detection. I’ve isolated the work down to a few methods of
<code class="highlighter-rouge">earwigbot.wiki.copyright.CopyrightMixin</code>: <code class="highlighter-rouge">_copyvio_strip_html()</code>, to
extract the “text” (i.e. content inside &lt;p&gt; tags) from an HTML document
(I’ll probably use something like
<a href="http://www.crummy.com/software/BeautifulSoup/">Beautiful Soup</a> for this);
<code class="highlighter-rouge">_copyvio_strip_article()</code>, to extract the “text” from an article (that is,
stripping templates, quotes, references); and <code class="highlighter-rouge">_copyvio_chunk_article()</code>, to
divide a stripped article into a list of web-searchable queries. Everything
else, including the Task class for <code class="highlighter-rouge">afc_copyvios</code> is done.</p>

<p>#2 is very simple once #1 is done. I’ve already written the code to load
EarwigBot’s wiki toolset from <code class="highlighter-rouge">copyvios.mako</code>, and the config file is written,
so running the detector is trivial once it works. The only thing left here is
to have the tool produce relatively eye-pleasing output, perhaps with a
“details” section showing the Markov chains formed from the two sources and
comparing them visually. Not necessary at all, but a nice touch.</p>

<p>Unfortunately, there’s still a bit more work to do on EarwigBot before he’s
ready for his first release (0.1!). Aside from the copyvio stuff above, which
is integrated directly as a function of <code class="highlighter-rouge">Page</code>, I want to finish porting over
the remaining tasks from old EarwigBot that are still running via cron, improve
the Wiki Toolset such that new sites can be added programmatically, and improve
config such that it can be created by the bot and not only by hand. This is the
main barrier stopping other people from running EarwigBot, and thus the primary
concern before v0.1 is good. Of course, none of this urgent; getting copyvio
detection finished is my primary concern.</p>

<h2 id="dynamic-backgrounds">Dynamic Backgrounds</h2>

<p>Now that that’s covered, let’s look at something (mostly unrelated) I finished
a couple days ago: dynamic backgrounds for
<a href="http://toolserver.org/~earwig/rewrite">my new toolserver site</a>! You can see it
in action a bit better on <a href="http://toolserver.org/~earwig/earwigbot">this page</a>.
The background is the the <a href="//commons.wikimedia.org/">Wikimedia Commons</a>
<a href="//commons.wikimedia.org/wiki/Commons:Picture_of_the_day">Picture of the Day</a>,
loaded and displayed with JavaScript.
<a href="//github.com/earwig/toolserver/blob/master/static/js/potd.js">Here’s the code for it</a>,
a good deal more code than I had expected to write.</p>

<p>Here’s what we have to do:</p>

<ol>
  <li>Query Commons’ API for the content of the template {{Potd/YYY-MM-DD}}.</li>
  <li>Parse that content for the filename of the image, which will be hidden in
something like {{Potd filename|1=Foo.png}}.</li>
  <li>Query Commons’ API again for Foo.png’s URL and dimensions.</li>
  <li>Since we want the image to “cover” the background (that is, be the smallest
size possible while leaving none of the background color visible), we need
to calculate the image’s aspect ratio and our own aspect ratio, then
determine the width of the thumbnail we want. If the image is shorter than
our screen, the necessary width is our screen’s width, but if the image is
longer than our screen, the necessary width is our screen’s height
multiplied by the image’s aspect ratio.</li>
  <li>If the width of our desired thumbnail is less than the width of the image,
we’ll alter the image’s URL (insert a <code class="highlighter-rouge">/thumb/</code> in the middle somewhere and
add a resolution at the end) and set that as our <code class="highlighter-rouge">body</code>’s <code class="highlighter-rouge">background-image</code>
property. This is better than loading the full image and downscaling it,
because less bandwidth is required.</li>
  <li>If the width of our desired thumbnail is <em>greater</em> than (or equal to) the
width of the image, we load the full image and upscale it (gasp! horror!)
using the CSS bit <code class="highlighter-rouge">background-size: cover;</code>.</li>
</ol>

<p>All of the images I tested looked decent when displayed under this method, some
better than others, but all acceptable. I figured this code provided a nice
touch to an otherwise drab webpage (like the one you’re viewing now, it
wouldn’t have been very pretty), which is why I did it, but I couldn’t help but
wonder if there was an… easier… method that still saved bandwidth and
didn’t resort to ugly scaling/cropping/repeating/whatever, but I could come up
with nothing. It was a fun project in a language I almost never use, though, so
worth it in the end.</p>

<dl>
  <dt>That’s all for now!</dt>
  <dd>
    <p>—earwig</p>
  </dd>
</dl>

    </div>
    
        <div id="disqus_thread"></div>
        <script>
            var disqus_shortname = 'syfy';
            var disqus_identifier = '/2012/01/29/earwigbot-and-toolserver-updates';
            var disqus_title = 'EarwigBot and Toolserver Updates';
            var disqus_url = 'https://byetimes.com/2012/01/29/earwigbot-and-toolserver-updates.html';
            var disqus_developer = 1;
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
</div>

            <div id="footer">
                <p>Copyright &copy; 2011&ndash;2017 再&nbsp;见 &bull; 
                <a href="https://github.com/myyyy/myyyy.github.io">View&nbsp;Source</a> &bull; 
                <!-- <a href="http://validator.w3.org/check?uri=referer">Valid&nbsp;HTML5</a> -->
                </p>
            </div>
        </div>
    </body>
</html>
