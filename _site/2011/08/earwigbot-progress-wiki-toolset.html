<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>EarwigBot Progress&#58; Wiki Toolset &ndash; good-bye</title>
        <meta name="description" content="YAWTF (Yet Another Wiki Tools Framework, or Yet Another... WTF?) &#124; Ben Kurtovic's blog">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/png" href="/static/favicon.png" />
        <link rel="stylesheet" href="/static/main.css" />
        <link rel="stylesheet" href="/static/syntax.css" />
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Ben Kurtovic" />
        <script src="//code.jquery.com/jquery-1.12.3.min.js" integrity="sha256-aaODHAgvwQW1bFOGXMeX+pC4PZIPsvn2h1sArYOhgXQ=" crossorigin="anonymous"></script>
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="/static/main.js"></script>
    </head>
    <body>
        <div id="banner">
            <a href="/">
                <img src="/static/avatar.png" title="good bye" alt="Earwig" />
                <h1>再 见。</h1>
            </a>
        </div>
        <div id="container">
            <h1>EarwigBot Progress&#58; Wiki Toolset</h1>
<div id="content">
    <ul id="post-info">
        <li><span><i class="fa fa-tag"></i> Tags:</span>
            
                <a href="/#Wikipedia" class="post-tag">Wikipedia</a>
            
                <a href="/#Status report" class="post-tag">Status report</a>
            
        <li><span><i class="fa fa-clock-o"></i> Date:</span> August 5, 2011</li>
        <li><span><i class="fa fa-comments"></i></span> <a href="#disqus_thread">Jump to comments</a></li>
    </ul>
    <div id="post">
        <p><strong>Update Aug 08, 2011</strong>: Some changes made thanks to updates in the new
<code class="highlighter-rouge">feature/tests-framework</code> branch.</p>

<p>So I’ve been spending the past week and a half working on EarwigBot’s new
wikitools framework thing (to avoid confusion with Mr.Z-man’s
<code class="highlighter-rouge">python-wikitools</code> package, I’m referring to it as “EarwigBot’s Wiki Toolset”
in the docs, even though it’s just <code class="highlighter-rouge">wiki</code> internally). Basically, it’s the
interface between EarwigBot and the MediaWiki API.</p>

<p>As Josh put it, this is “the thing that actually makes it work”.</p>

<p>So, now you can do this (from within Python’s interpreter, a wiki bot task, or
an IRC command):</p>

<figure class="highlight"><pre><code class="language-pycon" data-lang="pycon">&gt;&gt;&gt; import wiki
&gt;&gt;&gt; site = wiki.get_site()
&gt;&gt;&gt; print site.name()
enwiki
&gt;&gt;&gt; print site.project()
wikipedia
&gt;&gt;&gt; print site.lang()
en
&gt;&gt;&gt; print site.domain()
en.wikipedia.org</code></pre></figure>

<p>Our <code class="highlighter-rouge">config.json</code> file stores site information, along with our chosen “default
site”. Pretty neat, huh? “But what can it actually do?” I hear you ask? Well,
for example, we can get information about users:</p>

<figure class="highlight"><pre><code class="language-pycon" data-lang="pycon">&gt;&gt;&gt; user = site.get_user("The Earwig")
&gt;&gt;&gt; print user.editcount()
11079
&gt;&gt;&gt; print user.groups()
[u'*', u'user', u'autoconfirmed', u'abusefilter', u'sysop']
&gt;&gt;&gt; reg = user.registration()
&gt;&gt;&gt; import time
&gt;&gt;&gt; print time.strftime("%a, %d %b %Y %H:%M:%S", reg)
Thu, 03 Jul 2008 21:51:34</code></pre></figure>

<p>and pages as well, with intelligent namespace logic:</p>

<figure class="highlight"><pre><code class="language-pycon" data-lang="pycon">&gt;&gt;&gt; page = site.get_page("Wikipedia:Articles for creation")
&gt;&gt;&gt; print page.url()
http://en.wikipedia.org/wiki/Wikipedia:Articles_for_creation
&gt;&gt;&gt; print page.creator()
Uncle G
&gt;&gt;&gt; print page.namespace()
4
&gt;&gt;&gt; print site.namespace_id_to_name(4)
Wikipedia
&gt;&gt;&gt; print site.namespace_id_to_name(4, all=True)
[u'Wikipedia', u'Project', u'WP']
&gt;&gt;&gt; print page.is_talkpage()
False

&gt;&gt;&gt; talkpage = page.toggle_talk()
&gt;&gt;&gt; print talkpage.title()
Wikipedia talk:Articles for creation
&gt;&gt;&gt; print talkpage.is_talkpage()
True</code></pre></figure>

<p>and with support for redirect following:</p>

<figure class="highlight"><pre><code class="language-pycon" data-lang="pycon">&gt;&gt;&gt; page = site.get_page("Main page")
&gt;&gt;&gt; print page.is_redirect()
True
&gt;&gt;&gt; print page.get()
#REDIRECT [[Main Page]]
[[Category:Protected redirects]]
[[Category:Main Page| ]]
&gt;&gt;&gt; print page.get_redirect_target()
Main Page

&gt;&gt;&gt; page = site.get_page("Main page", follow_redirects=True)
&gt;&gt;&gt; print page.is_redirect()
False  # would only be True if "Main page" is a double redirect
&gt;&gt;&gt; print page.get()
&lt;!--        BANNER ACROSS TOP OF PAGE        --&gt;
{| id="mp-topbanner" style="width:100%; background:#f9f9f9; margin:1.2em 0 6px 0; border:1px solid #ddd;"
| style="width:61%; color:#000;" |
...</code></pre></figure>

<p>Of course, a Wiki Toolset would be nothing without login! Our username and
password are stored (encrypted with Blowfish) in the bot’s <code class="highlighter-rouge">config.json</code> file,
and we login automatically whenever we create a new Site object – unless
we’re already logged in, of course, and we know that based on whether we have
valid login cookies.</p>

<figure class="highlight"><pre><code class="language-pycon" data-lang="pycon">&gt;&gt;&gt; user = site.get_user()  # gets the logged-in user
&gt;&gt;&gt; print user.name()
EarwigBot</code></pre></figure>

<p>Cookies are stored in a special <code class="highlighter-rouge">.cookies</code> file in the project root (with no
access given to other users, of course). We support both per-project login and
CentralAuth, meaning I can do…</p>

<figure class="highlight"><pre><code class="language-pycon" data-lang="pycon">&gt;&gt;&gt; es = wiki.get_site("eswiki")
&gt;&gt;&gt; print es.get_user().name()
EarwigBot</code></pre></figure>

<p>without making additional logins. One thing I strove for when designing the
toolset was as minimal API usage as possible – we accept gzipped data, we
don’t make API queries unless they’re actually requested, and we combine
queries whenever possible. Of course, I’m probably doing it all wrong, but
it seems to be working so far.</p>

<dl>
  <dt>So… yeah. Carry on then!</dt>
  <dd>
    <p>—earwig</p>
  </dd>
</dl>

    </div>
    
        <div id="disqus_thread"></div>
        <script>
            var disqus_shortname = 'earwig';
            var disqus_identifier = '/2011/08/earwigbot-progress-wiki-toolset';
            var disqus_title = 'EarwigBot Progress&#58; Wiki Toolset';
            var disqus_url = 'https://byetimes.com/2011/08/earwigbot-progress-wiki-toolset.html';
            var disqus_developer = 1;
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
</div>

            <div id="footer">
                <p>Copyright &copy; 2011&ndash;2017 再&nbsp;见 &bull; <a href="//github.com/earwig/earwig.github.io">View&nbsp;Source</a> &bull; <a href="http://validator.w3.org/check?uri=referer">Valid&nbsp;HTML5</a></p>
            </div>
        </div>
    </body>
</html>
